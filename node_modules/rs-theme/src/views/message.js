import React from 'react';
import Reflux from 'reflux';
import Snackbar from 'material-ui/Snackbar';
import _ from 'underscore';
import MuiThemeProvider from 'material-ui/styles/MuiThemeProvider';
import getMuiTheme from 'material-ui/styles/getMuiTheme';
import {TodoActions, TodoMessages} from 'rs-todo';

const muiTheme = getMuiTheme();
export const MessageDefault = React.createClass({
    mixins: [
        Reflux.ListenerMixin
    ],
    getInitialState() {
        return {
            open: false,
            message: ''
        }
    },
    componentDidMount(){
        const self = this;
        _.each(TodoActions, (obj, key) => {
            let message = TodoMessages['after'.concat(key.charAt(0).toUpperCase().concat(key.slice(1)))];
            if (typeof message !== 'undefined') {
                self.listenTo(TodoActions[key].completed, (data) => {
                    if (data instanceof Object && typeof data.tokens !== 'undefined') {
                        _.each(data.tokens, (t, k) => {
                            message = message.replace(new RegExp(":".concat(k), "g"), t);
                        });
                    }
                    self.state.message = message;
                    self.state.open = true;
                    self.forceUpdate();
                });
            }
        });
    },
    render(){
        return (
            <MuiThemeProvider muiTheme={muiTheme}>
                <Snackbar
                    {...this.state}
                    autoHideDuration={4000}
                />
            </MuiThemeProvider>
        )
    }
});