import localTodo from '../models/localTodo';
import encryptor from 'simple-encryptor';
import {encryptPersist, decryptLoaded} from 'rs-helper/lib/server';

module.exports = (params) => {
    const app = params.app;
    const conf = params.conf;
    const io = params.io;

    const ec = encryptor(conf.key);

    const defaultHook = () => {
        io.emit('localTodo:changed');
    }

    app.models.localTodo.observe('after save', (ctx, next) => {
        defaultHook();
        next();
    });

    app.models.localTodo.observe('after delete', (ctx, next) => {
        defaultHook();
        next();
    });

    app.models.localTodo.observe('persist', (ctx, next) => {
        encryptPersist(ec, localTodo.properties, ctx);
        next();
    });

    app.models.localTodo.observe('loaded', (ctx, next) => {
        decryptLoaded(ec, localTodo.properties, ctx);
        next();
    });
}