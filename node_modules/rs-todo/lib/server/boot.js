'use strict';

var _localTodo = require('../models/localTodo');

var _localTodo2 = _interopRequireDefault(_localTodo);

var _simpleEncryptor = require('simple-encryptor');

var _simpleEncryptor2 = _interopRequireDefault(_simpleEncryptor);

var _server = require('rs-helper/lib/server');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

module.exports = function (params) {
    var app = params.app;
    var conf = params.conf;
    var io = params.io;

    var ec = (0, _simpleEncryptor2.default)(conf.key);

    var defaultHook = function defaultHook() {
        io.emit('localTodo:changed');
    };

    app.models.localTodo.observe('after save', function (ctx, next) {
        defaultHook();
        next();
    });

    app.models.localTodo.observe('after delete', function (ctx, next) {
        defaultHook();
        next();
    });

    app.models.localTodo.observe('persist', function (ctx, next) {
        (0, _server.encryptPersist)(ec, _localTodo2.default.properties, ctx);
        next();
    });

    app.models.localTodo.observe('loaded', function (ctx, next) {
        (0, _server.decryptLoaded)(ec, _localTodo2.default.properties, ctx);
        next();
    });
};